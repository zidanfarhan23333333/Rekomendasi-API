
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  user_id    Int      @id @default(autoincrement())
  nama       String
  email      String   @unique
  password   String
  role       String   // "admin" | "user"
  created_at DateTime @default(now())

  pemesanan        Pemesanan[]
  hasilRekomendasi HasilRekomendasi[]
  @@map("user")
}

model CabangOlahraga {
  cabor_id   Int    @id @default(autoincrement())
  nama_cabor String @unique

  pelatih   Pelatih[]
  pemesanan Pemesanan[]
  @@map("cabangolahraga")
}

model Pelatih {
  pelatih_id         Int      @id @default(autoincrement())
  nama               String
  cabor_id           Int
  pengalaman         Int      
  sertifikat         Int     
  biaya              Int      
  ketersediaan_waktu Boolean  
  status_verifikasi  String  
  created_at         DateTime @default(now())

  cabang           CabangOlahraga   @relation(fields: [cabor_id], references: [cabor_id])
  nilai            NilaiPelatih[]
  pemesanan        Pemesanan[]
  hasilRekomendasi HasilRekomendasi[]
  @@map("pelatih")
}

model Kriteria {
  kriteria_id   Int    @id @default(autoincrement())
  kode          String @unique   
  nama_kriteria String
  tipe          String           

  nilai    NilaiPelatih[]
  bobotRoc BobotRoc?
  @@map("kriteria")
}

model BobotRoc {
  roc_id      Int   @id @default(autoincrement())
  kriteria_id Int   @unique
  peringkat   Int
  bobot       Float

  kriteria Kriteria @relation(fields: [kriteria_id], references: [kriteria_id])
  @@map("bobotroc")
}

model NilaiPelatih {
  nilai_id    Int   @id @default(autoincrement())
  pelatih_id  Int
  kriteria_id Int
  nilai       Float

  pelatih  Pelatih  @relation(fields: [pelatih_id], references: [pelatih_id])
  kriteria Kriteria @relation(fields: [kriteria_id], references: [kriteria_id])

  @@unique([pelatih_id, kriteria_id])
  @@map("nilaipelatih")
}

model Pemesanan {
  pemesanan_id Int      @id @default(autoincrement())
  user_id      Int
  cabor_id     Int
  pelatih_id   Int?
  status       String   // "pending"|"konfirmasi"|"dibatalkan"
  tanggal      DateTime @default(now())

  user    User           @relation(fields: [user_id], references: [user_id])
  cabang  CabangOlahraga @relation(fields: [cabor_id], references: [cabor_id])
  pelatih Pelatih?       @relation(fields: [pelatih_id], references: [pelatih_id])
  @@map("pemesanan")
}

model HasilRekomendasi {
  rekomendasi_id Int      @id @default(autoincrement())
  user_id        Int
  pelatih_id     Int
  skor_akhir     Float
  peringkat      Int
  tanggal        DateTime @default(now())

  user    User    @relation(fields: [user_id], references: [user_id])
  pelatih Pelatih @relation(fields: [pelatih_id], references: [pelatih_id])
  @@map("hasilrekomendasi")
}
